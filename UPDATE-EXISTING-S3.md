# 🔄 Updating Your Existing S3 Portfolio to Next.js

This guide will help you update your current S3-hosted portfolio with the new Next.js version.

## 📋 Prerequisites

- Your existing S3 bucket name
- AWS CLI configured
- Node.js installed

## 🎯 Strategy: Zero Downtime Update

### Option 1: Direct Update (Recommended for Testing)
Replace the old files with new ones directly.

### Option 2: Blue-Green Deployment (Recommended for Production)
Keep old version accessible while deploying new version.

---

## ✅ Step-by-Step Update Process

### Step 1: Backup Your Current Site (5 minutes)

```bash
# Download current S3 content to backup folder
aws s3 sync s3://your-bucket-name ./backup-old-portfolio

# Or via AWS Console: Download all files manually
```

**Important**: Keep this backup until you're sure the new site works perfectly!

### Step 2: Install & Build New Portfolio (10 minutes)

```bash
# In your termproject directory

# 1. Rename package.json files
mv package.json package-old.json
mv package-new.json package.json

# 2. Install dependencies
npm install

# 3. Install additional required package
npm install tailwindcss-animate

# 4. Test locally first
npm run dev
```

Visit `http://localhost:3000` and verify everything looks good.

### Step 3: Update Your Content (30-60 minutes)

Before deploying, update these files with YOUR information:

1. **components/sections/experience-section.tsx** - Your real work history
2. **components/sections/hero-section.tsx** - Verify your info
3. **components/sections/about-section.tsx** - Your bio
4. **components/sections/skills-section.tsx** - Your skills
5. **components/sections/portfolio-section.tsx** - Your projects

### Step 4: Build for Production (2 minutes)

```bash
# Build the Next.js site
npm run build

# This creates the 'out' folder with static files
```

Verify the `out/` folder was created successfully.

### Step 5: Deploy to S3 (5 minutes)

#### Method A: Complete Replacement (Simple)

```bash
# Clear old content and upload new
aws s3 rm s3://your-bucket-name --recursive
aws s3 sync out/ s3://your-bucket-name

# Set proper content types for caching
aws s3 sync out/ s3://your-bucket-name \
  --cache-control "max-age=31536000" \
  --exclude "*.html" \
  --exclude "*.json"

aws s3 sync out/ s3://your-bucket-name \
  --cache-control "max-age=3600" \
  --include "*.html" \
  --include "*.json"
```

#### Method B: Sync Only (Safer)

```bash
# Sync new files, delete old ones
aws s3 sync out/ s3://your-bucket-name --delete
```

### Step 6: Invalidate CloudFront Cache (if using CloudFront)

```bash
# Get your distribution ID
aws cloudfront list-distributions

# Invalidate cache
aws cloudfront create-invalidation \
  --distribution-id YOUR_DISTRIBUTION_ID \
  --paths "/*"
```

**Note**: Invalidation takes 5-15 minutes to complete.

### Step 7: Test Your Live Site (5 minutes)

Visit your portfolio URL and check:

- ✅ Homepage loads correctly
- ✅ All sections display properly
- ✅ Dark/Light mode toggle works
- ✅ Mobile responsive (test on phone)
- ✅ Images load correctly
- ✅ Chatbot works
- ✅ Contact form displays
- ✅ Social links work
- ✅ Navigation works

---

## 🔍 What's Different in the New Structure?

### Old Structure (HTML/CSS/JS)
```
bucket/
├── index.html
├── css/
│   └── styles.css
├── js/
│   └── index.js
├── img/
└── portfolio-item*.html
```

### New Structure (Next.js)
```
bucket/
├── index.html           (generated by Next.js)
├── _next/              (Next.js assets)
│   ├── static/
│   └── ...
├── img/                (your existing images - reused!)
└── *.html              (generated pages)
```

**Key Points**:
- Next.js generates optimized HTML files
- Images folder (`img/`) is reused as-is
- New `_next` folder contains optimized assets
- Old HTML files are replaced with new generated ones

---

## 🚨 Troubleshooting

### Issue: Old site still showing after deployment

**Causes**:
1. Browser cache
2. CloudFront cache not invalidated

**Solutions**:
```bash
# Force browser refresh
Ctrl + Shift + R (Windows/Linux)
Cmd + Shift + R (Mac)

# Invalidate CloudFront
aws cloudfront create-invalidation --distribution-id YOUR_ID --paths "/*"

# Check S3 directly (bypass CloudFront)
http://your-bucket-name.s3-website-region.amazonaws.com
```

### Issue: 404 errors on page refresh

**Solution**: CloudFront needs custom error response

1. Go to CloudFront → Your Distribution → Error Pages
2. Create Custom Error Response:
   - HTTP Error Code: 404
   - Customize Error Response: Yes
   - Response Page Path: `/index.html`
   - HTTP Response Code: 200

### Issue: Images not loading

**Solution**:
```bash
# Make sure img folder was uploaded
aws s3 ls s3://your-bucket-name/img/

# If missing, upload from your local img folder
aws s3 sync img/ s3://your-bucket-name/img/
```

### Issue: Chatbot not working

**Check**:
1. AWS Lambda is still running
2. API Gateway endpoint is correct in `components/chatbot.tsx`
3. CORS is enabled on Lambda

---

## 📊 Before & After Comparison

| Aspect | Old (HTML/CSS/JS) | New (Next.js) |
|--------|------------------|---------------|
| Files | ~20 HTML files | ~15 optimized files |
| Size | ~5-10 MB | ~3-5 MB (optimized) |
| Load Time | 2-3 seconds | <1 second |
| Mobile | Basic responsive | Fully optimized |
| SEO | Basic meta tags | Full SEO optimization |
| Maintenance | Manual updates | Component-based |

---

## 💾 Rollback Plan (Just in Case)

If something goes wrong, you can quickly rollback:

```bash
# Restore from backup
aws s3 sync ./backup-old-portfolio s3://your-bucket-name --delete

# Invalidate CloudFront
aws cloudfront create-invalidation --distribution-id YOUR_ID --paths "/*"
```

---

## 🔄 Deployment Automation Script

Create `deploy-to-s3.sh` in your project root:

```bash
#!/bin/bash

# Configuration
BUCKET_NAME="your-bucket-name"
DISTRIBUTION_ID="your-cloudfront-id"  # Optional

echo "🚀 Starting deployment to S3..."

# Build the project
echo "📦 Building Next.js project..."
npm run build

if [ $? -ne 0 ]; then
    echo "❌ Build failed!"
    exit 1
fi

# Sync to S3
echo "☁️  Uploading to S3..."
aws s3 sync out/ s3://$BUCKET_NAME --delete

# Set cache headers for static assets
echo "⚙️  Setting cache headers..."
aws s3 sync out/ s3://$BUCKET_NAME \
  --cache-control "max-age=31536000" \
  --exclude "*.html" \
  --exclude "*.json" \
  --exclude "*.txt"

# Set cache headers for HTML files
aws s3 sync out/ s3://$BUCKET_NAME \
  --cache-control "max-age=3600" \
  --include "*.html" \
  --include "*.json"

# Invalidate CloudFront (if using)
if [ ! -z "$DISTRIBUTION_ID" ]; then
    echo "🔄 Invalidating CloudFront cache..."
    aws cloudfront create-invalidation \
      --distribution-id $DISTRIBUTION_ID \
      --paths "/*"
fi

echo "✅ Deployment complete!"
echo "🌐 Your site is live!"
```

Make it executable:
```bash
chmod +x deploy-to-s3.sh
```

Run it:
```bash
./deploy-to-s3.sh
```

---

## 📝 Post-Deployment Checklist

After deployment, verify:

- [ ] Site loads correctly
- [ ] All images display
- [ ] Dark mode works
- [ ] Mobile responsive
- [ ] Chatbot functional
- [ ] Forms work
- [ ] Links are correct
- [ ] SEO meta tags present (check page source)
- [ ] Social media links work
- [ ] Contact information correct
- [ ] Performance is good (use PageSpeed Insights)

---

## 🎯 Quick Update Commands

For future updates after initial deployment:

```bash
# Quick deploy (one command)
npm run build && aws s3 sync out/ s3://your-bucket-name --delete

# With CloudFront invalidation
npm run build && \
aws s3 sync out/ s3://your-bucket-name --delete && \
aws cloudfront create-invalidation --distribution-id YOUR_ID --paths "/*"
```

---

## 💡 Pro Tips

1. **Test locally first**: Always run `npm run dev` and test before deploying
2. **Build before deploy**: Always run `npm run build` fresh before uploading
3. **Check the 'out' folder**: Verify files look correct before uploading
4. **Use the sync command**: `aws s3 sync` is safer than `cp` - it only uploads changed files
5. **Monitor costs**: S3 + CloudFront should be very cheap (~$1-5/month for personal portfolio)
6. **Keep backups**: Always keep a backup of the working version

---

## 🆘 Need Help?

Common issues:
1. **Build errors**: Check Node.js version (`node -v` should be 18+)
2. **Upload errors**: Check AWS credentials (`aws configure list`)
3. **Site not updating**: Clear CloudFront cache
4. **Images missing**: Check S3 bucket permissions

---

## ✅ You're Ready!

Your S3 bucket will be updated with:
- Modern Next.js framework
- Better performance
- Improved SEO
- Professional design
- Same images and content

**Start with**: `npm install` → `npm run build` → Deploy to S3!

Good luck! 🚀
